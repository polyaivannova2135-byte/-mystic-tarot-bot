import random

# Список знаков (точно такие же, как на кнопках)
ZODIACS = [
    "Овен", "Телец", "Близнецы", "Рак",
    "Лев", "Дева", "Весы", "Скорпион",
    "Стрелец", "Козерог", "Водолей", "Рыбы",
]

# Привязка к стихиям
ELEMENT = {
    "Овен": "Огонь", "Лев": "Огонь", "Стрелец": "Огонь",
    "Телец": "Земля", "Дева": "Земля", "Козерог": "Земля",
    "Близнецы": "Воздух", "Весы": "Воздух", "Водолей": "Воздух",
    "Рак": "Вода", "Скорпион": "Вода", "Рыбы": "Вода",
}

# Таблица процентов для комбинаций стихий
ELEMENT_MATCH = {
    ("Огонь", "Огонь"): 85, ("Огонь", "Воздух"): 80,
    ("Огонь", "Земля"): 55, ("Огонь", "Вода"): 50,
    ("Воздух", "Воздух"): 75, ("Воздух", "Земля"): 60,
    ("Воздух", "Вода"): 55, ("Земля", "Земля"): 80,
    ("Земля", "Вода"): 75, ("Вода", "Вода"): 80,
}

# Переопределения для ярких пар
PAIR_OVERRIDE = {
    ("Овен", "Лев"): 90,
    ("Весы", "Близнецы"): 88,
    ("Скорпион", "Рыбы"): 86,
    ("Телец", "Дева"): 87,
    ("Козерог", "Дева"): 89,
    ("Водолей", "Стрелец"): 86,
}

# Тексты по категориям (по 5 вариантов)
TEXTS_ZODIAC = {
    "low": [
        "Совместимость знаков низкая. Различия заметны, и вам придётся искать баланс.",
        "Энергии стихий расходятся — важно учиться уважать границы.",
        "Сложный союз: многое будет требовать усилий и терпения.",
        "Разные ритмы жизни могут мешать гармонии. Поддерживайте открытый диалог.",
        "Может казаться, что вы из разных миров. Но это шанс на глубокий обмен опытом.",
    ],
    "mid": [
        "Средняя совместимость знаков. Здесь многое зависит от вашей зрелости.",
        "Есть точки соприкосновения, но также и различия, требующие терпения.",
        "Союз возможен, если каждый готов к компромиссам.",
        "Не всегда легко, но есть баланс. Учитесь договариваться — и всё получится.",
        "Вы способны поддерживать друг друга, если не будете игнорировать разногласия.",
    ],
    "high": [
        "Хорошая совместимость — энергия течёт легко, союз приносит радость.",
        "Часто понимаете друг друга с полуслова. Отличная база для отношений.",
        "Между вами естественная лёгкость, поддержка и комфорт.",
        "Энергии гармонируют. Оба можете вдохновлять и усиливать друг друга.",
        "Есть настоящая химия, которая создаёт ощущение партнёрства.",
    ],
    "very_high": [
        "Отличная совместимость! Союз сильный и яркий, как искра.",
        "Очень гармоничный союз: взаимная поддержка и вдохновение.",
        "Ваши стихии создают мощный поток, который питает отношения.",
        "Сильная энергетика пары: вы усиливаете лучшие качества друг друга.",
        "Союз, полный притяжения и радости. Берегите эту магию.",
    ],
}


def zodiac_percent(z1: str, z2: str) -> int:
    """Расчёт процентов по знакам"""
    if (z1, z2) in PAIR_OVERRIDE:
        return PAIR_OVERRIDE[(z1, z2)]
    if (z2, z1) in PAIR_OVERRIDE:
        return PAIR_OVERRIDE[(z2, z1)]

    e1, e2 = ELEMENT.get(z1), ELEMENT.get(z2)
    if not e1 or not e2:
        return 65

    return ELEMENT_MATCH.get((e1, e2), 65)


def _bucket_for_percent(p: int) -> str:
    if p < 40:
        return "low"
    elif p < 65:
        return "mid"
    elif p < 85:
        return "high"
    else:
        return "very_high"


def zodiac_text_for_percent(p: int) -> str:
    """Выбираем случайный текст из 5 по категории"""
    bucket = _bucket_for_percent(p)
    return random.choice(TEXTS_ZODIAC[bucket])
